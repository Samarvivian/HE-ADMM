# 🔐 HE-ADMM 分布式隐私计算项目通信协议

**版本**: v1.0  
**最后更新**: 2025-10-XX  
**维护者**: 黄维维 (系统集成)

## 1. 协议概述

本协议规定了HE-ADMM系统中**主节点**与**边缘节点**之间的通信规则。所有交互均基于TCP Socket，使用纯文本格式进行指令和数据交换，以确保简单性和可调试性。

## 2. 基础约定

- **传输层**: TCP
- **编码**: UTF-8
- **格式**: `指令:参数1,参数2,...`
- **端口**: `8888` (默认，可通过配置修改)
- **连接方式**: 主节点作为客户端，边缘节点作为服务端

## 3. 指令集详解

### 3.1 系统控制指令

#### `PING`
- **功能**: 心跳检测，测试连接是否通畅
- **参数**: 无
- **示例请求**: `PING`
- **成功响应**: `SUCCESS:PONG`
- **说明**: 用于基础连通性测试

### 3.2 数据预处理指令

#### `QUANTIZE`
- **功能**: 将浮点数量化为整数
- **参数**: `浮点数,最小值,最大值,Delta`
- **示例请求**: `QUANTIZE:3.14,-10.0,10.0,1000000`
- **成功响应**: `SUCCESS:1570000`
- **错误响应**: `ERROR:Invalid parameters`
- **说明**: 为Paillier加密准备整数输入

#### `INVERSE_QUANTIZE`
- **功能**: 将量化后的整数恢复为浮点数
- **参数**: `量化值,最小值,最大值,Delta`
- **示例请求**: `INVERSE_QUANTIZE:1570000,-10.0,10.0,1000000`
- **成功响应**: `SUCCESS:3.14`
- **说明**: 将解密结果转换回浮点数

### 3.3 同态加密指令

#### `ENCRYPT`
- **功能**: 加密一个整数
- **参数**: `明文整数`
- **示例请求**: `ENCRYPT:1570000`
- **成功响应**: `SUCCESS:891234567890` (加密后的长整数)
- **说明**: 使用Paillier算法加密

#### `DECRYPT`
- **功能**: 解密密文
- **参数**: `密文`
- **示例请求**: `DECRYPT:891234567890`
- **成功响应**: `SUCCESS:1570000`
- **说明**: 将密文解密为原始整数

### 3.4 同态运算指令

#### `HOMO_ADD`
- **功能**: 对两个密文进行同态加法
- **参数**: `密文1,密文2`
- **示例请求**: `HOMO_ADD:891234567890,912345678901`
- **成功响应**: `SUCCESS:1823579246791` (同态加法的结果密文)
- **说明**: Paillier的同态加法：Enc(a) * Enc(b) = Enc(a+b)

#### `HOMO_MUL_CONST`
- **功能**: 密文与常数相乘（同态乘常数）
- **参数**: `密文,常数`
- **示例请求**: `HOMO_MUL_CONST:891234567890,3`
- **成功响应**: `SUCCESS:2673703703670`
- **说明**: Paillier的同态乘常数：Enc(a)^k = Enc(a*k)

### 3.5 ADMM计算指令

#### `COMPUTE_LOCAL_UPDATE`
- **功能**: 执行ADMM本地更新计算
- **参数**: `加密观测向量,加密z向量,加密v向量,rho参数`
- **示例请求**: `COMPUTE_LOCAL_UPDATE:enc_alpha,enc_z,enc_v,1.5`
- **成功响应**: `SUCCESS:enc_local_x`
- **说明**: 在边缘节点上完成(13)式的加密计算

## 4. 响应状态码

| 状态码    | 含义         | 示例                                    |
| --------- | ------------ | --------------------------------------- |
| `SUCCESS` | 操作成功完成 | `SUCCESS:12345`                         |
| `ERROR`   | 操作失败     | `ERROR:Invalid encryption parameters`   |
| `TIMEOUT` | 操作超时     | `TIMEOUT:Homomorphic operation timeout` |

## 5. 完整工作流程示例

### ADMM单次迭代流程
1. **主节点 → 边缘节点**: `COMPUTE_LOCAL_UPDATE:enc_alpha,enc_z_prev,enc_v_prev,1.0`
2. **边缘节点 → 主节点**: `SUCCESS:enc_x_new`
3. **主节点**: 解密 `enc_x_new`，更新z和v
4. **主节点 → 边缘节点**: 加密新的z和v，准备下一次迭代

### 加密数据传输流程
1. **主节点**: `QUANTIZE:2.5,-5.0,5.0,1000000` → `SUCCESS:2500000`
2. **主节点**: `ENCRYPT:2500000` → `SUCCESS:891234567890`
3. **主节点** 发送密文到边缘节点进行同态计算
4. **边缘节点** 返回计算结果密文
5. **主节点**: `DECRYPT:1823579246791` → `SUCCESS:5000000`
6. **主节点**: `INVERSE_QUANTIZE:5000000,-5.0,5.0,1000000` → `SUCCESS:5.0`

## 6. 错误处理规范

- **超时处理**: 任何操作超过30秒无响应应断开连接
- **重试机制**: 网络错误自动重试3次
- **数据验证**: 所有参数都应进行类型和范围检查
- **日志记录**: 所有请求和响应都应记录时间戳和状态

## 7. 附录

### 7.1 数据类型说明
- **浮点数**: IEEE 754标准，如 `3.14`, `-2.5`
- **整数**: 64位有符号整数，如 `1570000`, `-500000`
- **密文**: Paillier加密后的大整数，如 `89123456789012345`

### 7.2 安全考虑
- 协议本身不提供加密，依赖Paillier的内容加密
- 生产环境应考虑TLS传输层加密
- 敏感参数应进行模糊处理

---

## 
